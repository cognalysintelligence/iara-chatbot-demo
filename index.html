<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IARA × CognalysIntelligence - Solution Chatbot Intelligente</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #a4a4dc 0%, #a49cdc 50%, #dcd4fc 100%);
            min-height: 100vh;
            overflow-x: hidden;
            color: white;
        }

        /* Particules d'arrière-plan optimisées */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: float 20s infinite linear;
            will-change: transform;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Navigation optimisée */
        .nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
            padding: 1rem 2rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: background, box-shadow;
        }

        .nav-container {
            display: flex;
            justify-content: center;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .partnership-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .logo-iara {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .iara-icon {
            width: 40px;
            height: 40px;
            background: #c3b4fb;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .collaboration-x {
            font-size: 1.5rem;
            opacity: 0.7;
        }

        .logo-cognalys {
            background: linear-gradient(45deg, #c3b4fb, #a49cdc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        /* Section Hero optimisée */
        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            z-index: 2;
            padding: 6rem 2rem 2rem;
        }

        .hero-content {
            max-width: 900px;
            animation: fadeInUp 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .hero h1 {
            font-size: clamp(2.5rem, 6vw, 4.5rem);
            font-weight: 800;
            margin-bottom: 1.5rem;
            background: linear-gradient(45deg, #fff, #ccc0fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.1;
        }

        .hero-subtitle {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            opacity: 0.9;
            line-height: 1.6;
        }

        .value-proposition {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 3rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .cta-button {
            background: linear-gradient(45deg, #c3b4fb, #a49cdc);
            color: white;
            padding: 1.2rem 3rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            will-change: transform;
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        /* Chat Interface - Design personnalisé */
        .chat-section {
            padding: 3rem 1rem;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        .chat-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 2rem;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.3s both;
        }

        .chat-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .chat-header h2 {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #fff, #dcd4fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .chat-widget-container {
            min-height: 500px;
            border-radius: 20px;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .chat-messages {
            height: 400px;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 80%;
            padding: 0.8rem 1.2rem;
            border-radius: 18px;
            word-wrap: break-word;
            animation: messageSlide 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .message.user {
            align-self: flex-end;
            background: linear-gradient(45deg, #c3b4fb, #a49cdc);
            color: white;
        }

        .message.bot {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Pré-questions */
        .pre-questions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            justify-content: center;
        }

        .pre-question {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 0.6rem 1rem;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s;
        }

        .pre-question:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .chat-input-container {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 0.8rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .chat-input:focus {
            border-color: #a49cdc;
            background: rgba(255, 255, 255, 0.15);
        }

        .send-button {
            padding: 0.8rem 1.5rem;
            background: linear-gradient(45deg, #c3b4fb, #a49cdc);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 0.5rem;
            padding: 0.8rem 1.2rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 18px;
            max-width: fit-content;
            margin: 0.5rem 1rem; /* espace avec les bords du chat */
        }

        .typing-dots {
            display: flex;
            gap: 0.2rem;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.7);
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; }
            30% { opacity: 1; }
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Features Section optimisée */
        .features {
            padding: 3rem 1rem;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        .features h2 {
            text-align: center;
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            margin-bottom: 3rem;
            background: linear-gradient(45deg, #fff, #dcd4fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            will-change: transform;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.15);
        }

        .feature-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            background: linear-gradient(45deg, #c3b4fb, #a49cdc);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .feature-card h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
        }

        .feature-card p {
            opacity: 0.9;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .offer-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }

        .offer-section h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #a49cdc;
        }

        /* Footer */
        .footer {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            padding: 2rem;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            z-index: 2;
        }

        /* Animations optimisées */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Design amélioré */
        @media (max-width: 768px) {
            .nav {
                padding: 0.8rem 1rem;
            }

            .partnership-logo {
                font-size: 1rem;
                gap: 0.5rem;
            }

            .iara-icon {
                width: 35px;
                height: 35px;
                font-size: 1.2rem;
            }

            .hero {
                padding: 6rem 1rem 2rem;
                min-height: 100vh;
            }

            .value-proposition {
                padding: 1.5rem;
                margin-bottom: 2rem;
            }

            .chat-container {
                margin: 1rem;
                padding: 1.5rem;
            }

            .chat-messages {
                height: 300px;
            }

            .message {
                max-width: 90%;
                font-size: 0.9rem;
            }

            .features-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .feature-card {
                padding: 1.2rem;
            }

            .offer-section {
                padding: 1.5rem;
            }

            .cta-button {
                padding: 1rem 2rem;
                font-size: 1rem;
            }

            .chat-input-container {
                padding: 0.8rem;
            }

            .chat-input {
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .hero-logo { width: 70vw; }
            .chat-container { margin: 0.5rem; padding: 1rem; }

            /* Réorganisation du widget de chat pour mobile */
            .chat-widget-container { display:flex; flex-direction: column; height: 75vh; }
            .chat-messages { flex: 1; height: auto; }
            .chat-input-container { margin-top: auto; }

            .hero {
                padding: 6rem 1rem 1rem; /* plus d'espace pour le menu fixe */
            }

            .hero-subtitle {
                font-size: 1.1rem;
            }

            .chat-container {
                padding: 1rem;
            }

            .feature-card {
                padding: 1rem;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .partnership-logo {
                flex-direction: column;
                gap: 0.3rem;
                font-size: 0.9rem;
            }

            .collaboration-x {
                display: none;
            }
        }

        /* Optimisations de performance */
        .hero-content,
        .feature-card,
        .chat-container {
            transform: translateZ(0);
        }

        /* Scrollbar personnalisée pour le chat */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        .about-section {
            padding: 4rem 1rem;
            text-align: center;
            position: relative;
            z-index: 2;
        }
        .about-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .about-logo {
            width: 200px;
            max-width: 60%;
            height: auto;
            margin-bottom: 1.5rem;
            filter: drop-shadow(0 4px 15px rgba(0,0,0,0.2));
        }
        .about-section h2 {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #fff, #dcd4fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .about-section p {
            font-size: 1.1rem;
            line-height: 1.6;
            opacity: 0.9;
        }
    .hero-logo {
            width: clamp(250px, 45vw, 600px);
            max-width: 70vw;
            height: 70%;
            margin-bottom: 1rem;
            display: block;
            margin-left: auto;
            margin-right: auto;
            filter: drop-shadow(0 4px 15px rgba(0,0,0,0.25));
        }
        .replace-word {
            color:#E1D8F2;
            font-weight: 700;
            font-style: italic;
        }
    @media (max-width: 480px) {
        .send-button {
            padding: 0.6rem 0.9rem;
            font-size: 1.2rem;
        }
    }
    </style>
</head>
<body>
    <!-- Particules animées -->
    <div class="particles" id="particles"></div>

    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-container">
            <div class="partnership-logo">
                <div class="logo-iara">
                    <img src="https://i.ibb.co/xqkFN5Zz/logo-9ddc0f13.png" alt="IARA Logo" style="height:40px;">
                </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Section Hero -->
    <section class="hero">
        <div class="hero-content">
            <img src="https://i.ibb.co/hJrD67FN/Design-sans-titre-5-Photoroom.png" alt="Cognalys Logo" class="hero-logo">
            <h1>Révolutionnez votre Support Client avec l'IA</h1>
            <p class="hero-subtitle">Cognalys Intelligence propose à Iara une solution de chatbot intelligent pour améliorer l'expérience client et optimiser vos opérations.</p>
            
            <div class="value-proposition">
                <p><strong>🚀 Test gratuit sans risque</strong> - Nous déployons notre chatbot sur notre infrastructure privée avec vos données publiquement accessibles (FAQ, informations site, etc.) pour une phase de test complète sans toucher à vos systèmes existants.</p>
            </div>
            
            <a href="#demo" class="cta-button">
                <span>Tester le Chatbot</span>
                <span>→</span>
            </a>
        </div>
    </section>

    <!-- Démonstration du Chat -->
    <section class="chat-section" id="demo">
        <div class="chat-container">
            <div class="chat-header">
                <h2>Démonstration Interactive</h2>
                <p>Testez dès maintenant <span class="replace-word">notre</span> chatbot intelligent. Posez vos questions comme le feraient vos client(e)s&nbsp;!</p>
            </div>
            <div class="chat-widget-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="message bot">
                        👋 Bonjour ! Je suis l'assistant IARA. Comment puis-je vous aider aujourd'hui ?
                    </div>
                </div>
                <div class="pre-questions" id="preQuestions">
                    <button class="pre-question">L’application est-elle vraiment gratuite ?</button>
                    <button class="pre-question">Y a-t-il des commissions ou frais cachés en plus du forfait iara ?</button>
                    <button class="pre-question">Mes client(e)s recevront-ils/elles bien des rappels (e-mail, SMS, notifications) avant chaque rendez-vous ?</button>
                </div>
                <div class="typing-indicator" id="typingIndicator">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                    <span>L'assistant écrit...</span>
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Posez vos questions" maxlength="500">
                    <button class="send-button" id="sendButton" aria-label="Envoyer">⬆</button>
                </div>
            </div>
        </div>
    </section>

    <section class="about-section">
        <div class="about-container">
            <h2>Qui sommes-nous&nbsp;?</h2>
            <p>Nous sommes une agence spécialisée dans le développement de solutions d’automatisation sur mesure enrichies par l’intelligence artificielle. Nous concevons et intégrons des systèmes personnalisés répondant précisément à vos besoins métiers : automatisation comptable, gestion intelligente des relances, secrétariat virtuel optimisé ou encore gestion avancée des plannings avec des agents IA. Notre objectif est de transformer vos processus internes pour gagner en efficacité et en productivité.</p>
        </div>
    </section>

    <!-- Fonctionnalités -->
    <section class="features">
        <h2>Pourquoi choisir notre solution ?</h2>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">🤖</div>
                <h3>Conversations Intelligentes</h3>
                <p>Capable de discuter avec vos clients, répondre à leurs questions, les conseiller et même convertir des prospects en clients.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🔄</div>
                <h3>Transfert Intelligent</h3>
                <p>Le bot transfère automatiquement vers un humain quand la situation devient complexe, garantissant une expérience client optimale.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">📊</div>
                <h3>Analyses Avancées</h3>
                <p>Analyse les conversations pour identifier les problèmes récurrents et génère des résumés hebdomadaires, journaliers ou mensuels.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🕐</div>
                <h3>Disponible 24/7</h3>
                <p>Votre chatbot ne dort jamais ! Support client continu pour répondre aux urgences et questions hors heures de bureau.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">💰</div>
                <h3>Réduction des Coûts</h3>
                <p>Diminuez drastiquement vos coûts de support en automatisant 80% des demandes clients courantes.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">📈</div>
                <h3>Augmentation des Ventes</h3>
                <p>Convertit les visiteurs en clients grâce à des réponses personnalisées et des recommandations intelligentes.</p>
            </div>
        </div>

        <div class="offer-section">
            <h3>🎁 Offre Spéciale pour IARA</h3>
            <p>Nous vous proposons de créer gratuitement un chatbot personnalisé avec vos données (FAQ, informations de votre site, etc.) pour une phase de test complète. Tout reste sur notre infrastructure privée aucun impact sur vos systèmes. Si les résultats vous convainquent, nous discuterons ensemble de l'intégration définitive.</p>
            <br>
            <p><strong>📋 Bonus :</strong> Résumés automatiques des questions/plaintes clients les plus fréquentes pour améliorer continuellement votre service.</p>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 CognalysIntelligence - Repensons vos systèmes avec Intelligence</p>
        <p>Solution chatbot intelligente sur infrastructure privée sécurisée</p>
    </footer>

    <script>
        // Configuration du chat N8N
        const WEBHOOK_URL = 'https://n8n.srv860531.hstgr.cloud/webhook/8d968a8e-cac7-4025-9dcb-04860beef267/chat';
        let sessionId = 'iara-demo-' + Math.random().toString(36).substring(7);
        
        // Éléments du DOM
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');

        // Fonction de formatage des messages du bot
        function formatMessage(raw) {
            // Échapper les caractères HTML pour éviter les injections
            const escaped = raw
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;");
            // Gras avec **texte** et sauts de ligne avec //n
            return escaped
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\/\/n/g, '<br>')
                .replace(/\n/g, '<br>');
        }

        // Fonction pour ajouter un message au chat
        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            if (isUser) {
                messageDiv.textContent = content;
            } else {
                messageDiv.innerHTML = formatMessage(content);
            }
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Fonction pour envoyer un message au webhook N8N
        async function sendMessageToN8N(message) {
            try {
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'sendMessage',
                        sessionId: sessionId,
                        chatInput: message,
                        loadPreviousSession: true
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                return data.output || data.response || data.message || "Je suis désolé, je n'ai pas pu traiter votre demande.";
                
            } catch (error) {
                console.error('Erreur lors de l\'envoi du message:', error);
                return "Je rencontre actuellement des difficultés techniques. Veuillez réessayer dans quelques instants.";
            }
        }

        // Fonction pour afficher l'indicateur de frappe
        function showTypingIndicator() {
            typingIndicator.style.display = 'flex';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Fonction pour masquer l'indicateur de frappe
        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }

        // Fonction pour envoyer un message
        async function sendMessage() {
            const preQ = document.getElementById('preQuestions');
            if (preQ) preQ.style.display = 'none';
            const message = chatInput.value.trim();
            if (!message) return;

            // Désactiver l'input et le bouton
            chatInput.disabled = true;
            sendButton.disabled = true;
            
            // Ajouter le message de l'utilisateur
            addMessage(message, true);
            chatInput.value = '';

            // Afficher l'indicateur de frappe
            showTypingIndicator();

            // Envoyer le message à N8N
            const botResponse = await sendMessageToN8N(message);
            
            // Masquer l'indicateur de frappe
            hideTypingIndicator();
            
            // Ajouter la réponse du bot avec un délai réaliste
            setTimeout(() => {
                addMessage(botResponse);
                
                // Réactiver l'input et le bouton
                chatInput.disabled = false;
                sendButton.disabled = false;
                chatInput.focus();
            }, 500);
        }

        // Event listeners pour le chat
        sendButton.addEventListener('click', sendMessage);

        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Création des particules optimisée
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const numParticles = window.innerWidth < 768 ? 15 : 30;

            // Limiter le nombre de particules pour améliorer les performances
            for (let i = 0; i < numParticles; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 15) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Effet de parallaxe optimisé avec throttling
        let ticking = false;
        
        function parallaxEffect() {
            if (!ticking) {
                requestAnimationFrame(() => {
                    if (window.innerWidth > 768) {
                        const hero = document.querySelector('.hero');
                        const scrolled = window.pageYOffset;
                        const rate = scrolled * -0.2; // Réduit l'effet pour plus de fluidité
                        
                        if (hero) {
                            hero.style.transform = `translateY(${rate}px)`;
                        }
                    }
                    ticking = false;
                });
                ticking = true;
            }
        }

        // Effet glassmorphique sur la navigation optimisé
        function navScrollEffect() {
            const nav = document.querySelector('.nav');
            if (window.scrollY > 50) {
                nav.style.background = 'rgba(255, 255, 255, 0.15)';
                nav.style.boxShadow = '0 10px 30px rgba(0, 0, 0, 0.2)';
            } else {
                nav.style.background = 'rgba(255, 255, 255, 0.1)';
                nav.style.boxShadow = 'none';
            }
        }

        // Animations d'intersection optimisées
        function observeElements() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '50px'
            });

            document.querySelectorAll('.feature-card, .chat-container, .offer-section').forEach(el => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(30px)';
                el.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
                observer.observe(el);
            });
        }

        // Smooth scrolling pour les liens internes
        function setupSmoothScroll() {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        const offsetTop = target.offsetTop - 80;
                        window.scrollTo({
                            top: offsetTop,
                            behavior: 'smooth'
                        });
                    }
                });
            });
        }

        // Gestion du redimensionnement optimisée
        let resizeTimeout;
        function handleResize() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                // Recréer les particules si nécessaire
                const particles = document.querySelectorAll('.particle');
                const expectedCount = window.innerWidth < 768 ? 15 : 30;
                if (particles.length !== expectedCount) {
                    document.getElementById('particles').innerHTML = '';
                    createParticles();
                }
            }, 250);
        }

        // Throttle fonction pour optimiser les performances
        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }

        // Fonction d'initialisation du chat N8N
        function initializeChat() {
            // Envoyer un message d'initialisation pour établir la session
            setTimeout(() => {
                sendMessageToN8N('init').catch(error => {
                    console.log('Initialisation du chat N8N:', error);
                });
            }, 1000);
        }

        // Fonction pour gérer les erreurs de connexion
        function handleConnectionError() {
            addMessage("⚠️ Connexion temporairement indisponible. Notre équipe technique travaille sur le problème. Vous pouvez nous contacter directement pour toute urgence.");
        }

        // Vérification périodique de la connexion
        function checkConnection() {
            fetch(WEBHOOK_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'ping', sessionId: sessionId })
            }).catch(() => {
                console.log('Vérification de connexion N8N');
            });
        }

        // Animation remplacement mot "notre" -> "votre"
        function animateWordReplacement(cb) {
            const el = document.querySelector('.replace-word');
            if (!el) return;
            const original = 'notre';
            const target = 'votre';
            let index = original.length;

            function deleteLetters() {
                if (index >= 0) {
                    el.textContent = original.substring(0, index);
                    index--;
                    setTimeout(deleteLetters, 120);
                } else {
                    index = 0;
                    typeLetters();
                }
            }

            function typeLetters() {
                if (index <= target.length) {
                    el.textContent = target.substring(0, index);
                    index++;
                    setTimeout(typeLetters, 120);
                } else if (cb) {
                    cb();
                }
            }

            deleteLetters();
        }

        function observeWordReplacement() {
            const el = document.querySelector('.replace-word');
            if (!el) return;
            let isAnimating = false;
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && !isAnimating) {
                        isAnimating = true;
                        animateWordReplacement(() => { isAnimating = false; });
                    }
                });
            }, { threshold: 0.8 });
            observer.observe(el);
        }

        // Initialisation de l'application
        document.addEventListener('DOMContentLoaded', function() {
            // Créer les particules
            createParticles();
            
            // Initialiser les observateurs
            observeElements();
            observeWordReplacement();
            
            // Configurer le smooth scroll
            setupSmoothScroll();
            
            // Initialiser le chat
            initializeChat();

            // Gestion des pré-questions
            const preQuestions = document.getElementById('preQuestions');
            if (preQuestions) {
                preQuestions.addEventListener('click', (e) => {
                    if (e.target && e.target.classList.contains('pre-question')) {
                        const question = e.target.textContent.trim();
                        chatInput.value = question;
                        sendMessage();
                        preQuestions.style.display = 'none';
                    }
                });
            }
            
            // Vérifier la connexion périodiquement
            setInterval(checkConnection, 60000); // Chaque minute
            
            // Suppression du focus automatique qui provoquait un scroll en milieu de page
            // chatInput.focus();
        });

        // Event listeners optimisés
        window.addEventListener('scroll', throttle(() => {
            parallaxEffect();
            navScrollEffect();
        }, 16)); // ~60fps

        window.addEventListener('resize', handleResize);

        // Effet hover optimisé sur les cartes de fonctionnalités
        document.addEventListener('DOMContentLoaded', function() {
            const featureCards = document.querySelectorAll('.feature-card');
            featureCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.background = 'rgba(255, 255, 255, 0.15)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.background = 'rgba(255, 255, 255, 0.1)';
                });
            });
        });

        // Optimisation pour les appareils mobiles
        if ('ontouchstart' in window) {
            // Désactiver le parallaxe sur mobile pour de meilleures performances
            document.body.style.setProperty('--parallax-enabled', '0');
        }

        // Précharger les ressources critiques
        function preloadCriticalResources() {
            const link = document.createElement('link');
            link.rel = 'preconnect';
            link.href = 'https://n8n.srv860531.hstgr.cloud';
            document.head.appendChild(link);
        }

        // Gestion des erreurs globales
        window.addEventListener('error', function(e) {
            console.error('Erreur JavaScript:', e.error);
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('Promise rejetée:', e.reason);
        });

        // Initialiser le préchargement
        preloadCriticalResources();

        // Amélioration de l'accessibilité
        document.addEventListener('keydown', function(e) {
            // Navigation au clavier pour le chat
            if (e.target === chatInput && e.key === 'Escape') {
                chatInput.blur();
            }
        });

        // Performance monitoring basique
        window.addEventListener('load', function() {
            setTimeout(() => {
                if (performance.navigation.type === performance.navigation.TYPE_RELOAD) {
                    console.log('Page rechargée');
                }
            }, 1000);
        });
    </script>
</body>
</html>
